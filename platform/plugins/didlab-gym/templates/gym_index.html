{% extends "base.html" %}

{% block content %}
<div class="container">
  <h1>DIDLab Gym</h1>

  <p>
    Practice challenges across all courses and events.
    This view is course-aware for enrolled students and open for practice users.
  </p>

  {% if course_code %}
    <p>
      <strong>Your course:</strong> {{ course_code }}
      {% if section %} (section {{ section }}){% endif %}
      {% if term %}, {{ term }}{% endif %}
    </p>
  {% else %}
    <p>
      <strong>You are registered as a practice / guest user.</strong>
      You see only open practice problems.
    </p>
  {% endif %}

  <div class="btn-group mb-3" role="group" aria-label="Gym views">
    <a class="btn btn-{% if view == 'course_week' %}primary{% else %}secondary{% endif %}"
       href="{{ url_for('didlab_gym.gym_index', view='course_week') }}">
      My course – this week{% if week %} (Week {{ week }}){% endif %}
    </a>

    <a class="btn btn-{% if view == 'course_all' %}primary{% else %}secondary{% endif %}"
       href="{{ url_for('didlab_gym.gym_index', view='course_all') }}">
      My course – all weeks
    </a>

    <a class="btn btn-{% if view == 'practice_all' %}primary{% else %}secondary{% endif %}"
       href="{{ url_for('didlab_gym.gym_index', view='practice_all') }}">
      All practice
    </a>
  </div>

  {% if view == 'course_week' and course_code %}
    <p>Showing challenges tagged for your course and <strong>Week {{ week }}</strong>.</p>
  {% elif view == 'course_all' and course_code %}
    <p>Showing <strong>all challenges</strong> tagged for your course.</p>
  {% else %}
    <p>Showing all challenges tagged <code>mode:practice</code>.</p>
  {% endif %}

  {% if not challenges %}
    <div class="alert alert-info mt-3">
      No challenges match this view yet. Check that tags (course:..., week:..., mode:...) are set correctly.
    </div>
  {% else %}
    <table class="table table-striped mt-3">
      <thead>
        <tr>
          <th>Category</th>
          <th>Challenge</th>
          <th>Points</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
      {% for c in challenges %}
        <tr>
          <td>{{ c.category }}</td>
          <td>
            <!-- Direct link to challenge detail -->
            <a href="/challenges/{{ c.id }}">{{ c.name }}</a>
          </td>
          <td>{{ c.value }}</td>
          <td>
            {% if c.solved %}
              <span class="badge bg-success">Solved</span>
            {% else %}
              <span class="badge bg-secondary">Unsolved</span>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
{% endblock %}
